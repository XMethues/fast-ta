# rs-ta-lib

[![Rust](https://img.shields.io/badge/rust-1.78+-blue.svg)](https://www.rust-lang.org)
[![License](https://img.shields.io/badge/license-MIT%2FApache--2.0-blue.svg)](LICENSE)

Rust å®ç°çš„é«˜æ€§èƒ½æŠ€æœ¯åˆ†ææŒ‡æ ‡åº“ï¼ˆTA-Lib çš„ Rust ç‰ˆæœ¬ï¼‰

## ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: SIMD ä¼˜åŒ–ï¼Œé›¶æ‹·è´ APIï¼Œå»¶è¿Ÿ < 1Î¼s
- ğŸ”„ **åŒæ¨¡è®¡ç®—**: æ”¯æŒæ‰¹é‡ï¼ˆç¦»çº¿åˆ†æï¼‰å’Œæµå¼ï¼ˆå®æ—¶å¤„ç†ï¼‰æ¨¡å¼
- ğŸ¦€ **Rust åŸç”Ÿ**: çº¯ Rust å®ç°ï¼Œæ”¯æŒ `no_std`ï¼Œé›¶å¤–éƒ¨ä¾èµ–
- ğŸ¯ **ç²¾ç¡®åŒ¹é…**: 100% æ•°å€¼ç²¾åº¦åŒ¹é…åŸç‰ˆ TA-Lib Cï¼ˆÎµ < 1e-10ï¼‰
- ğŸ **Python æ”¯æŒ**: é€šè¿‡ PyO3 æä¾› Python ç»‘å®š
- ğŸŒ **WASM æ”¯æŒ**: é€šè¿‡ wasm-bindgen æä¾› WebAssembly æ”¯æŒ

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. é›¶æ‹·è´ä¼˜å…ˆ (Zero-Copy)

```rust
// âœ… æ­£ç¡®ï¼šé›¶æ‹·è´æ¥å£
fn calculate(&self, input: &[f64], output: &mut [f64]) -> Result<usize>;

// âŒ é”™è¯¯ï¼šè¿”å›Vecï¼ˆæœ‰åˆ†é…ï¼‰
fn calculate(&self, input: &[f64]) -> Result<Vec<f64>>;
```

### 2. SIMD ä¸€ç­‰å…¬æ°‘ (Simplified)

**Phase 1**: ä½¿ç”¨çº¯ `std::simd`ï¼Œ**æ—  `#[cfg]` æ¡ä»¶ç¼–è¯‘**

```rust
use std::simd::{f64x4, SimdFloat};

pub type SimdF64 = f64x4;
pub const LANES: usize = 4;

pub fn sum_simd(data: &[f64]) -> f64 {
    let chunks = data.chunks_exact(LANES);
    let sum_vec: SimdF64 = chunks
        .map(|chunk| SimdF64::from_slice(chunk))
        .reduce(|a, b| a + b)
        .unwrap_or(SimdF64::splat(0.0));
    sum_vec.reduce_sum()
}
```

**Phase 2+**: æ ¹æ®æ€§èƒ½åˆ†æï¼ŒæŒ‰éœ€æ·»åŠ  `#[cfg]` ä¼˜åŒ–

### 3. åŒæ¨¡è®¡ç®—èŒƒå¼

```rust
pub trait BatchIndicator<const N: usize = 1> {
    fn compute(&self, inputs: &[Self::Input], outputs: &mut [Self::Output]) -> Result<usize>;
}

pub trait StreamingIndicator<const N: usize = 1> {
    fn next(&self, state: &mut Self::State, input: Self::Input) -> Option<Self::Output>;
}
```

### 4. æ¥å£ä¸¥æ ¼è§£è€¦

```
Workspace
â”œâ”€â”€ ta-core (çº¯Rust, no_std) â† çº¯ç®—æ³•å®ç°
â”œâ”€â”€ ta-py (PyO3) â† ä¾èµ– ta-core
â””â”€â”€ ta-wasm (wasm-bindgen) â† ä¾èµ– ta-core
```

### 5. éªŒè¯é©±åŠ¨å¼€å‘

- Level 1: å•å…ƒæµ‹è¯•
- Level 2: ç²¾åº¦éªŒè¯ (vs TA-Lib C, Îµ < 1e-10)
- Level 3: ä¸€è‡´æ€§éªŒè¯ (æ‰¹é‡ vs æµå¼)
- Level 4: æ€§èƒ½åŸºå‡†

## é¡¹ç›®ç»“æ„

```
rs-indicators/
â”œâ”€â”€ .sisyphus/
â”‚   â”œâ”€â”€ IMPLEMENTATION_PLAN.md    # è¯¦ç»†å®æ–½è®¡åˆ’
â”‚   â”œâ”€â”€ PROJECT_README.md         # æœ¬æ–‡æ¡£
â”‚   â””â”€â”€ README.md                 # é¡¹ç›®æ€»è§ˆ
â”œâ”€â”€ Cargo.toml (workspace)
â””â”€â”€ crates/
    â”œâ”€â”€ ta-core/     # æ ¸å¿ƒåº“ (no_std)
    â”œâ”€â”€ ta-py/       # Python ç»‘å®š
    â”œâ”€â”€ ta-wasm/     # WASM ç»‘å®š
    â””â”€â”€ ta-benchmarks/ # åŸºå‡†æµ‹è¯•
```

## å®æ–½è®¡åˆ’

### é˜¶æ®µæ€»è§ˆ

| é˜¶æ®µ | åç§° | æŒç»­æ—¶é—´ | ä¸»è¦äº¤ä»˜ç‰© |
|------|------|----------|------------|
| **Phase 1** | æ ¸å¿ƒåŸºç¡€è®¾æ–½ | 4 å‘¨ | Workspace, traits, SIMD å±‚ |
| **Phase 2** | é‡å ç ”ç©¶æŒ‡æ ‡ | 4 å‘¨ | 16 ä¸ªç§»åŠ¨å¹³å‡æŒ‡æ ‡ |
| **Phase 3** | åŠ¨é‡æŒ‡æ ‡ | 4 å‘¨ | 33 ä¸ªåŠ¨é‡æŒ‡æ ‡ |
| **Phase 4** | æˆäº¤é‡ä¸æ³¢åŠ¨ç‡ | 3 å‘¨ | 6 ä¸ªæŒ‡æ ‡ |
| **Phase 5** | ç»‘å®šå±‚ | 3 å‘¨ | Python å’Œ WASM ç»‘å®š |
| **Phase 6** | éªŒè¯ä¸ä¼˜åŒ– | 4 å‘¨ | å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œæ€§èƒ½ä¼˜åŒ– |

**æ€»å·¥æœŸ**: 26 å‘¨ï¼ˆçº¦ 6 ä¸ªæœˆï¼‰

### Phase 1 è¯¦ç»†ä»»åŠ¡

**ä»»åŠ¡ 1.1**: åˆ›å»º Workspace ç»“æ„ (8h)
- [ ] 1.1.1 åˆ›å»º workspace æ ¹ç›®å½•å’Œ Cargo.toml
- [ ] 1.1.2 åˆ›å»º `ta-core` crate
- [ ] 1.1.3 åˆ›å»º `ta-py` crate
- [ ] 1.1.4 åˆ›å»º `ta-wasm` crate
- [ ] 1.1.5 åˆ›å»º `ta-benchmarks` crate

**ä»»åŠ¡ 1.2**: å®ç°é”™è¯¯ç±»å‹ç³»ç»Ÿ (6h)
- [ ] 1.2.1 å®šä¹‰ `TalibError` æšä¸¾
- [ ] 1.2.2 å®ç° `std::error::Error` trait
- [ ] 1.2.3 å®ç°é”™è¯¯è½¬æ¢
- [ ] 1.2.4 åˆ›å»º Result ç±»å‹åˆ«å
- [ ] 1.2.5 ç¼–å†™å•å…ƒæµ‹è¯•

**ä»»åŠ¡ 1.3**: å®ç°æ ¸å¿ƒ Traits (12h)
- [ ] 1.3.1 å®šä¹‰ `BatchIndicator` trait
- [ ] 1.3.2 å®šä¹‰ `StreamingIndicator` trait
- [ ] 1.3.3 å®šä¹‰ `DualModeIndicator` trait
- [ ] 1.3.4 å®ç°ç¤ºä¾‹æŒ‡æ ‡ï¼ˆSMAï¼‰
- [ ] 1.3.5 ç¼–å†™å•å…ƒæµ‹è¯•

**ä»»åŠ¡ 1.4**: å®ç° SIMD æŠ½è±¡å±‚ (10h)
- [ ] 1.4.1 åˆ›å»º `simd.rs` æ¨¡å—
- [ ] 1.4.2 å®šä¹‰ SIMD ç±»å‹ (`SimdF64 = f64x4`)
- [ ] 1.4.3 å®ç° `sum_simd` å‡½æ•°
- [ ] 1.4.4 å®ç° `sma_simd` å‡½æ•°
- [ ] 1.4.5 ç¼–å†™å•å…ƒæµ‹è¯•

**ä»»åŠ¡ 1.5**: è®¾ç½®æµ‹è¯•åŸºç¡€è®¾æ–½ (6h)
- [ ] 1.5.1 é…ç½®æµ‹è¯•æ¡†æ¶
- [ ] 1.5.2 åˆ›å»ºæµ‹è¯•å·¥å…·å‡½æ•°
- [ ] 1.5.3 æ·»åŠ ç¤ºä¾‹æµ‹è¯•æ•°æ®

**Phase 1 éªŒæ”¶æ ‡å‡†**:
- [ ] Workspace å¯ä»¥æˆåŠŸç¼–è¯‘
- [ ] æ‰€æœ‰æ ¸å¿ƒ traits æœ‰å®Œæ•´æ–‡æ¡£
- [ ] SIMD å±‚é€šè¿‡æ‰€æœ‰å•å…ƒæµ‹è¯•
- [ ] ä»£ç è¦†ç›–ç‡ > 80%

## æŠ€æœ¯å†³ç­–

### SIMD ç­–ç•¥å†³ç­–

| æ–¹æ¡ˆ | æ¡ä»¶ç¼–è¯‘ | å¤æ‚åº¦ | å¯ç»´æŠ¤æ€§ | é€‚ç”¨é˜¶æ®µ |
|------|----------|--------|----------|----------|
| v1 (åˆå§‹) | 9ä¸ª `#[cfg]` å— | é«˜ | ä½ | åæœŸä¼˜åŒ– |
| **v2 (å½“å‰)** | **æ— ** | **ä½** | **é«˜** | **Phase 1** |

âœ… **é‡‡ç”¨ v2 æ–¹æ¡ˆ**: Phase 1 çº¯ `std::simd`ï¼ŒPhase 2+ æŒ‰éœ€æ·»åŠ  `#[cfg]`

## ç›¸å…³æ–‡æ¡£

- [IMPLEMENTATION_PLAN.md](.sisyphus/IMPLEMENTATION_PLAN.md) - è¯¦ç»†å®æ–½è®¡åˆ’
- [CONTRIBUTING.md](CONTRIBUTING.md) - è´¡çŒ®æŒ‡å—
- [CHANGELOG.md](CHANGELOG.md) - å˜æ›´æ—¥å¿—

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT æˆ– Apache-2.0 åŒé‡è®¸å¯è¯æˆæƒã€‚è¯¦æƒ…è¯·æŸ¥çœ‹ [LICENSE-MIT](LICENSE-MIT) å’Œ [LICENSE-APACHE](LICENSE-APACHE) æ–‡ä»¶ã€‚

## è‡´è°¢

- åŸç‰ˆ [TA-Lib](http://ta-lib.org/) é¡¹ç›®æä¾›ç®—æ³•å‚è€ƒ
- Rust SIMD å·¥ä½œç»„æä¾› `std::simd` æ”¯æŒ
- æ‰€æœ‰è´¡çŒ®è€…å’Œç¤¾åŒºæˆå‘˜

---

<p align="center">
  <strong>ğŸš€ é«˜æ€§èƒ½æŠ€æœ¯åˆ†æï¼Œç”¨ Rust å®ç°</strong>
</p>
